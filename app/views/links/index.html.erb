<%= render('layouts/navbar.html.erb') %>
<% n=1 %>

<div class="container">

  <table class="table table-condensed">
    <% Link.all.each do |link| %>
      <tr>
        <td rowspan="2"><%= n %></td>
        <td rowspan="2">

          <% if current_user != nil %>
            <%= form_for link.votes.new do |f| %>
              <%= f.hidden_field :user_id, :value => "#{current_user.id}"%>
              <%= f.hidden_field :link_id, :value => link.id %>
              <%= f.submit "#{link.votes.length}"%>
            <% end %>
          <% else %>
            <a href="/login"><button><%= link.votes.length %></button></a>
          <% end %>

        </td>
        <td><a href="<%=link.url%>"><%=link.page_title%> (<%= link.url %>)</a></td>
      </tr>
      <tr>
        <td><%= link.sum_vote %> points by <%= link.user.email %> <%= distance_of_time_in_words(Time.now, link.created_at) %> ago | <%= link.comments.length %> comments</td>
      </tr>
      <% n = n+1 %>
    <% end %>
  </table>

</div>

